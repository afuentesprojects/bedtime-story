<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bedtime Story Generator</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <h1>ðŸŒ™ Bedtime Story Generator</h1>
        
        <form id="storyForm">
            <!-- Length Input -->
            <div class="form-group">
                <label for="length">Reading Time (minutes):</label>
                <input type="number" id="length" name="length" min="1" max="30" value="5" required>
            </div>

            <!-- Story Type Selection -->
            <div class="form-group">
                <label>Story Type:</label>
                <div class="radio-group">
                    <label class="radio-label">
                        <input type="radio" name="story_type" value="made_up" checked>
                        100% Made Up (Original Story)
                    </label>
                    <label class="radio-label">
                        <input type="radio" name="story_type" value="classic">
                        Classic Story
                    </label>
                    <label class="radio-label">
                        <input type="radio" name="story_type" value="mixed">
                        Mixed (Classic with Modifications)
                    </label>
                </div>
            </div>

            <!-- Modifications Input (shown only for mixed type) -->
            <div class="form-group" id="modificationsGroup" style="display: none;">
                <label for="modifications">Modifications to the classic story:</label>
                <textarea id="modifications" name="modifications" rows="3" 
                          placeholder="e.g., 'Make Little Red Riding Hood a brave astronaut instead'"></textarea>
            </div>

            <!-- Language Selection -->
            <div class="form-group">
                <label for="language">Language:</label>
                <select id="language" name="language">
                    <option value="English">English</option>
                    <option value="Spanish">Spanish</option>
                </select>
            </div>

            <!-- Generate Button -->
            <button type="submit" id="generateBtn">Generate Story</button>
        </form>

        <!-- Loading Indicator -->
        <div id="loading" style="display: none;">
            <p>âœ¨ Generating your bedtime story...</p>
        </div>

        <!-- Story Output -->
        <div id="storyOutput" style="display: none;">
            <h2>Your Bedtime Story</h2>
            <div id="storyText"></div>
            <button id="newStoryBtn">Generate Another Story</button>
        </div>

        <!-- Error Message -->
        <div id="error" style="display: none;">
            <p class="error-message"></p>
        </div>
    </div>

    <script>
        const form = document.getElementById('storyForm');
        const loading = document.getElementById('loading');
        const storyOutput = document.getElementById('storyOutput');
        const storyText = document.getElementById('storyText');
        const error = document.getElementById('error');
        const modificationsGroup = document.getElementById('modificationsGroup');
        const storyTypeRadios = document.querySelectorAll('input[name="story_type"]');
        const newStoryBtn = document.getElementById('newStoryBtn');

        // Show/hide modifications field based on story type
        storyTypeRadios.forEach(radio => {
            radio.addEventListener('change', function() {
                if (this.value === 'mixed') {
                    modificationsGroup.style.display = 'block';
                } else {
                    modificationsGroup.style.display = 'none';
                }
            });
        });

        // Handle form submission
        form.addEventListener('submit', async function(e) {
            e.preventDefault();

            // Hide previous results and errors
            storyOutput.style.display = 'none';
            error.style.display = 'none';
            loading.style.display = 'block';

            // Gather form data
            const formData = {
                length: document.getElementById('length').value,
                story_type: document.querySelector('input[name="story_type"]:checked').value,
                language: document.getElementById('language').value,
                modifications: document.getElementById('modifications').value
            };

            try {
                const response = await fetch('/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });

                const result = await response.json();
                loading.style.display = 'none';

                if (result.success) {
                    storyText.textContent = result.story;
                    storyOutput.style.display = 'block';
                } else {
                    error.querySelector('.error-message').textContent = 
                        'Error generating story: ' + result.error;
                    error.style.display = 'block';
                }
            } catch (err) {
                loading.style.display = 'none';
                error.querySelector('.error-message').textContent = 
                    'Error: Could not connect to the server. ' + err.message;
                error.style.display = 'block';
            }
        });

        // Handle "Generate Another Story" button
        newStoryBtn.addEventListener('click', function() {
            storyOutput.style.display = 'none';
            form.style.display = 'block';
            window.scrollTo(0, 0);
        });
    </script>
</body>
</html>
